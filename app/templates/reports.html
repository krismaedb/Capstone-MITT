{% extends "base_dashboard.html" %}
{% block title %}Reports & Analytics{% endblock %}

{% block content %}
<h2><i class="fas fa-chart-bar"></i> Reports & Analytics</h2>

<div class="row mt-4">
    <div class="col-md-4">
        <div class="card p-3 text-center">
            <h4>Total Patients</h4>
            <h2>{{ total_patients }}</h2>
        </div>
    </div>
</div>

<hr>

<!-- Patient Gender Distribution -->
<h4>Patient Gender Distribution</h4>
<div class="chart-container" style="max-width: 400px; height: 300px;">
    <canvas id="genderChart"></canvas>
</div>

<!-- Blood Type Distribution -->
<h4 class="mt-5">Blood Type Distribution</h4>
<div class="chart-container" style="max-width: 400px; height: 300px;">
    <canvas id="bloodChart"></canvas>
</div>

<!-- Appointment Status -->
<h4 class="mt-5">Appointment Status</h4>
<div class="chart-container" style="max-width: 400px; height: 300px;">
    <canvas id="statusChart"></canvas>
</div>

<!-- Appointments Per Month -->
<h4 class="mt-5">Appointments Per Month</h4>
<div class="chart-container" style="max-width: 600px; height: 300px;">
    <canvas id="monthChart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
//Convert this tojson
const genderLabels = {{ gender_labels | tojson if gender_labels is defined else '[]' }};
const genderData = {{ gender_data | tojson if gender_data is defined else '[]' }};

const bloodLabels = {{ blood_labels | tojson if blood_labels is defined else '[]' }};
const bloodData = {{ blood_data | tojson if blood_data is defined else '[]' }};

const statusLabels = {{ status_labels | tojson if status_labels is defined else '[]' }};
const statusData = {{ status_data | tojson if status_data is defined else '[]' }};

const monthLabels = {{ month_labels | tojson if month_labels is defined else '[]' }};
const monthData = {{ month_data | tojson if month_data is defined else '[]' }};

// Gender Chart
new Chart(document.getElementById('genderChart'), {
    type: 'pie',
    data: {
        labels: genderLabels,
        datasets: [{
            data: genderData,
            backgroundColor: ['#3498db', '#e74c3c', '#9b59b6']
        }]
    }
});

// Blood Type Chart
new Chart(document.getElementById('bloodChart'), {
    type: 'bar',
    data: {
        labels: bloodLabels,
        datasets: [{
            data: bloodData,
            backgroundColor: '#1abc9c'
        }]
    }
});

// Status Chart
new Chart(document.getElementById('statusChart'), {
    type: 'doughnut',
    data: {
        labels: statusLabels,
        datasets: [{
            data: statusData,
            backgroundColor: ['#f1c40f', '#2ecc71', '#e67e22', '#e74c3c']
        }]
    }
});

// Monthly Appointments
new Chart(document.getElementById('monthChart'), {
    type: 'line',
    data: {
        labels: monthLabels,
        datasets: [{
            label: 'Appointments',
            data: monthData,
            borderColor: '#2980b9',
            fill: false
        }]
    }
});
</script>

{% endblock %}
